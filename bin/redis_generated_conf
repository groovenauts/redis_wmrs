#!/usr/bin/env ruby
# -*- coding: utf-8 -*-

action, filepath, generated_mark = *ARGV

generated_mark ||= "# Generated by CONFIG REWRITE"
idx = `grep -n "#{generated_mark}" #{filepath} | cut -d : -f1`.strip
exit(0) if idx.nil? or idx.empty?

case action
when 'show' then
  n = File.read(filepath).lines.length - idx.to_i + 1
  cmd = "tail -n #{n} #{filepath}"
  $stdout.puts `#{cmd}`
when 'remove' then
  content = `head -n #{idx.to_i - 1} #{filepath}`
  open(filepath, "w"){|f| f.puts(content)}
else
  raise "invalid action: #{action}"
end
